{% extends 'base.html' %}

{% block title %}<h1>Game Page</h1>{% endblock %}

{% block content %}
<a href="/main-page">Return to main page</a>

<p>Current Game: ({{ game_id }}) {{ game_name }} ({{ game_description }})</p><br>

<ul class='game-events'>
        {% for game in game_info %}
            {% if loop.index == 1 %}

                <form class='current' id='event{{ loop.index }}'>
                    Event # ({{ game.event_order }}) {{ game.story_text }}<br>
                    Puzzle: {{ game.puzzle }}<br>
                    <input type='text' name='puzzle_response' id='response{{ loop.index }}'>
                    <input type='submit' value='Submit' onclick='getResponse()'><br>
                    <p class='hidden' id='hint{{ loop.index }}'>Hint: {{ game.puzzle_hint }}</p>



                </form>
            {% else %}
                <form class='hidden' id='event{{ loop.index }}'>
                    Event # ({{ game.event_order }}) {{ game.story_text }}<br>
                    Puzzle: {{ game.puzzle }}<br>
                    <input type='text' name='puzzle_response' id='response{{ loop.index }}'>
                    <input type='submit' value='Submit' onclick='getResponse()'><br>
                    <p class='hidden' id='hint{{ loop.index }}'>Hint: {{ game.puzzle_hint }}</p>          
                </form>
            {% endif %}
        {% endfor %}
</ul>

<script>
    let counter = 1;
    let puzzle_index = 0;
    let hints = 0;

    function getResponse() {
        // Prevent re-routing.
        event.preventDefault();

        // Pass in list of puzzle keys, list of puzzle hints.
        let puzzle_key = {{ puzzle_key | safe }};
        let hints = {{ hints | safe }};

        // Take user response from text box.
        let response = document.getElementById("response" + counter).value;

        // Check if user response is same as puzzle key.

        if (response === puzzle_key[puzzle_index]) {
            // If correct, increment the puzzle key and execute class change.
            puzzle_index += 1;

            changeEvent();         

        } else {
            // If wrong, pop up hint.
            let hint = document.getElementById("hint" + counter);
            hint.setAttribute('class', 'hint');

            console.log("Wrong answer.");
        }
    }

    function changeEvent() {
        // This line of code is to make the current event disabled.
        $('#event' + counter).children().attr('disabled', true);

        // These next lines of code are to set the next event as current.
        next = document.getElementById('event'+ (counter + 1));
        next.setAttribute('class', 'current');

        counter += 1;
    }


</script>

<br>
<br>


{% endblock %}

